##creates file for each entry

data=read.table("./output/profileForProtein.txt")
bestScales=unique(read.table("./output/selectedScales.txt",sep = "+"))


file.remove("./output/testfilefinal")
file.remove("./output/RBProfile.final")

##loop over bestscales
for (ll in seq(1,dim(bestScales)[1]))
{
	line=bestScales[ll,]
	#get motit,get scale
	motif=as.character(line$V1)
	scale=line$V2
	#print(motif)
	#print(scale)
######select pos########################	
	pdom=data[which(data$V2==motif),]
	pscale=pdom[which(pdom$V3==scale),]
	pfinale=pscale[,4:24]
######select negatives########################
#	nname=paste("/mnt/large/carmen/Profile/Lysate_otherFormat/Lysate",scale,".neg",sep="")
	nname=paste("./Gutfreund_accum/Gutfreund",scale,".neg",sep="")
	#nname=paste("/mnt/large/carmen/Profile/Pos_otherFormat/PMSliste",scale,".pos",sep="")
	neg=read.table(nname)
	ndom=neg[which(neg$V2==motif),]
	nscale=ndom[which(ndom$V3==scale),]
	nfinale=nscale[,4:24]
#	for (i in seq(1:20))
	i=17 ##at the moment we use corr=0.8
	{	
		
		nval=nfinale[,i]
		pval=pfinale[,i]
		amount=length(nval[which(pval>nval)])
		value=amount/nrow(nfinale)
		out=paste(i,amount,scale,motif,value,sep=" ")
		write(out,"./output/testfilefinal",append=T)

	}
#	tr=read.table("testfilefinal")
#	final=tr[which(tr$V5==max(tr$V5)),]
	#corr=1/10*final$V1
#	value=final$V2/nrow(nfinale)
#	end=paste(motif,scale,value,sep=" ")
#	write(end,file="RBProfile.final",append=T)
}

tr=read.table("./output/testfilefinal")
oo=tr[which(tr$V5==max(tr$V5)),]
end=paste(as.character(oo$V4),oo$V3,oo$V5,sep=" ")
write(end,file="./output/RBProfile.final",append=T)


